<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Create Meeting & Invite â€“ Middle Ground</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <link
      rel="stylesheet"
      href="app.css"
    />
  </head>
  <body>
    <main class="container">
      <header class="topbar">
        <div class="brand">
          <span
            class="brand-badge"
            aria-hidden="true"
          ></span>
          <a
            href="/"
            class="link-home"
            >Middle&nbsp;Ground</a
          >
        </div>
        <nav class="nav">
          <a
            class="btn btn-ghost"
            href="/places.html"
            >Places</a
          >
          <span id="auth-inline">
            <a
              class="btn btn-ghost"
              href="/login.html"
              >Log in</a
            >
            <a
              class="btn btn-primary"
              href="/signup.html"
              >Sign up</a
            >
          </span>
        </nav>
      </header>
      <section class="grid">
        <div class="meet-card">
          <h3>New meeting</h3>
          <div class="grid-1">
            <div class="row">
              <label for="meetingTitle">Title</label>
              <input
                id="meetingTitle"
                placeholder="e.g., Friday Hangout"
              />
            </div>
            <div class="meet-cardLayout">
              <button
                id="createMeeting"
                class="btn btn-primary"
                type="button"
              >
                Create meeting
              </button>
              <span
                id="meetStatus"
                class="muted"
              ></span>
            </div>
            <div
              id="meetingInfo"
              class="muted"
              style="display: none"
            ></div>
          </div>
        </div>

        <div class="meet-card">
          <h3>Send email invitations</h3>
          <p
            class="muted"
            id="inviteHelp"
          >
            Create a meeting first.
          </p>
          <div class="grid-1">
            <div class="row">
              <label for="inviteEmail">Invitee email</label>
              <input
                id="inviteEmail"
                type="email"
                placeholder="friend@example.com"
              />
            </div>
            <div class="meet-cardLayout">
              <button
                id="sendInvite"
                class="btn btn-primary"
                type="button"
                disabled
              >
                Send invite
              </button>
              <span
                id="inviteStatus"
                class="muted"
              ></span>
            </div>
            <div>
              <div
                class="muted small"
                style="margin: 10px 0 6px"
              >
                Invitations sent (this session)
              </div>
              <div
                id="invitedList"
                class="list"
              ></div>
            </div>
          </div>
        </div>

        <div class="meet-card invitations">
          <h3>My invitations</h3>
          <p class="muted small">
            These are invites sent to your account email.
          </p>
          <div
            id="myInvites"
            class="list"
          ></div>
        </div>
      </section>
    </main>

    <script
      src="/meet.js"
      defer
    ></script>

    <script>
      async function tryJson(res) {
        const ct = res.headers.get("content-type") || "";
        if (!ct.includes("application/json")) return null;
        try {
          return await res.json();
        } catch {
          return null;
        }
      }
      (async function renderAuth() {
        try {
          const res = await fetch("/api/me", { credentials: "same-origin" });
          const data = await tryJson(res);
          if (!data || !data.user) return;
          const username = data.user.username;
          const authInline = document.getElementById("auth-inline");
          if (authInline) {
            authInline.innerHTML = `
            <span style="opacity:.85; margin-right:.25rem;">Signed in as <b>${username}</b></span>
            <button class="btn btn-ghost" id="logoutBtnTop">Log out</button>
          `;
            document
              .getElementById("logoutBtnTop")
              ?.addEventListener("click", async () => {
                await fetch("/api/logout", {
                  method: "POST",
                  credentials: "same-origin",
                });
                location.reload();
              });
          }
        } catch {}
      })();
    </script>
  </body>
</html>
